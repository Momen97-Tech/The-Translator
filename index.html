<!DOCTYPE html>

<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>The Translator V1</title>
<link rel="icon" href="icon.png">

<style>
  :root {
      --primary-color: #4b7bec;
      --primary-hover: #3a64b1;
      --bg-light: #f7f9fc;
      --bg-dark: #2c3e50;
      --card-light: #ffffff;
      --card-dark: #34495e;
      --text-light: #222;
      --text-dark: #ecf0f1;
      --border-color-light: #dcdcdc;
      --border-color-dark: #555;
      --font-family: 'Verdana', sans-serif; /* Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø®Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£ØµÙ„ÙŠ Ù„Ù„ØªØ±Ø¬Ù…Ø© */
      --general-font: 'Segoe UI', Tahoma, Geneva, sans-serif;
  }

  /* 4. Ø£Ø¬Ø¹Ù„ Ø§Ø·Ø±Ø§Ù Ø§Ù„ØµÙØ­Ø© ÙØ§Ø±ÙØ© (Ø¥Ø¶Ø§ÙØ© Ù‡ÙˆØ§Ù…Ø´ ÙƒØ¨ÙŠØ±Ø©) */
  body {
    font-family: var(--general-font);
    margin: 0;
    padding: 0;
    background: var(--bg-light);
    color: var(--text-light);
    display: flex;
    transition: background 0.3s, color 0.3s;
    min-height: 100vh;
  }
  body.dark {
    background: var(--bg-dark);
    color: var(--text-dark);
  }

  /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
  #sidebar {
    width: 280px; /* Ø²ÙŠØ§Ø¯Ø© Ù‚Ù„ÙŠÙ„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
    background: var(--card-light);
    border-left: 1px solid var(--border-color-light);
    height: 100vh;
    padding: 20px;
    overflow-y: auto;
    transition: transform 0.3s;
    position: fixed;
    right: 0;
    top: 0;
    z-index: 1000;
    box-shadow: -2px 0 5px rgba(0, 0, 0, 0.05);
  }
  body.dark #sidebar {
    background: var(--card-dark);
    border-color: var(--border-color-dark);
  }
  #sidebar.hidden {
    transform: translateX(100%);
  }

  /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
  #main {
    flex: 1;
    /* 4. Ø¥Ø¶Ø§ÙØ© Ù‡ÙˆØ§Ù…Ø´ Ù…Ù†Ø§Ø³Ø¨Ø© Ø­ÙˆÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (ÙØ±Ø§Øº ÙƒØ¨ÙŠØ± Ø­ÙˆÙ„ Ø§Ù„ØµÙØ­Ø©) */
    padding: 30px 5%; /* Ù‡Ø§Ù…Ø´ Ø¬Ø§Ù†Ø¨ÙŠ ÙƒØ¨ÙŠØ± */
    margin-right: 280px;
    transition: margin-right 0.3s;
    position: relative;
    max-width: 1200px; /* ØªØ­Ø¯ÙŠØ¯ Ø£Ù‚ØµÙ‰ Ø¹Ø±Ø¶ Ù„Ù€ #main Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
    margin-left: auto; /* Ù„ØªÙˆØ³ÙŠØ· Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
    margin-right: 280px;
  }
  #sidebar.hidden + #main {
    margin-right: 0;
  }
  /* ØªÙˆØ³ÙŠØ· Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¹Ù†Ø¯ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
  #sidebar.hidden + #main {
    margin-right: auto;
    padding-right: 5%;
  }

  /* 3. ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ± - Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ù„ØªØ±Ø¬Ù…Ø© */
  #translation-area {
    display: flex;
    flex-direction: row; /* Ù…ØªØ¬Ø§ÙˆØ± Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ */
    gap: 15px;
    margin-bottom: 20px;
  }
  
  /* Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ù„Ø¥Ø®Ø±Ø§Ø¬ */
  .translator-box {
    flex: 1;
    min-width: 0; /* Ù…Ù‡Ù… Ù„Ù€ flexbox */
    background: var(--card-light);
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    padding: 20px;
    position: relative;
    height: 250px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„ØªØ±Ø¬Ù…Ø© */
  }
  body.dark .translator-box {
    background: var(--card-dark);
  }
  
  /* ØªÙ†Ø³ÙŠÙ‚ Ø­Ù‚Ù„ Ø§Ù„Ù†Øµ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±Ø¨Ø¹ */
  .translator-box textarea {
    width: 100%;
    height: 100%;
    border: none;
    resize: none;
    padding: 0;
    margin: 0;
    background: transparent;
    font-size: 24px; /* Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø­Ø¬Ù… Ø§Ù„Ø®Ø· */
    line-height: 1.5;
    font-family: var(--font-family);
    color: var(--text-light);
    outline: none;
  }
  body.dark .translator-box textarea {
    color: var(--text-dark);
  }
  
  /* ØªØ®ØµÙŠØµ Ø®Ø§Øµ Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
  #input-box textarea {
    font-weight: normal;
  }

  /* ØªØ®ØµÙŠØµ Ø®Ø§Øµ Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬ */
  #output-box textarea {
    font-weight: bold;
    direction: rtl; /* Ø¶Ù…Ø§Ù† Ø¹Ø±Ø¶ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ */
  }

  /* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø± Ø§Ù„Ù†Ø·Ù‚ (Speaker) Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ */
  .speak-btn {
    position: absolute;
    bottom: 10px;
    left: 10px;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 20px;
    color: var(--primary-color);
    margin: 0;
    padding: 8px;
    opacity: 0.7;
    transition: opacity 0.2s, color 0.2s;
  }
  .speak-btn:hover {
    opacity: 1;
    color: var(--primary-hover);
  }
  
  /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
  button {
    padding: 10px 18px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    background: var(--primary-color);
    color: white;
    margin: 4px 2px;
    font-size: 16px;
    transition: background 0.2s, transform 0.1s;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }
  button:hover {
    background: var(--primary-hover);
    transform: translateY(-1px);
  }

  /* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Edit) */
  .edit-btn {
    background: #ffa726; /* Ù„ÙˆÙ† Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
    padding: 5px 8px;
    font-size: 14px;
    margin-left: 5px;
  }
  .edit-btn:hover {
    background: #fb8c00;
  }


  /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© */
  .word-list div {
    padding: 8px 12px;
    background: var(--card-light);
    margin-bottom: 8px;
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: grab;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }
  body.dark .word-list div {
    background: var(--card-dark);
    border-color: var(--border-color-dark);
  }
  
  .word-list .word-pair {
    flex-grow: 1;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    flex-wrap: wrap; /* Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ø§Ù„ØªÙƒØ³ÙŠØ± Ø¹Ù„Ù‰ Ø®Ø·ÙˆØ· Ù…ØªØ¹Ø¯Ø¯Ø© */
    cursor: pointer;
    font-size: 15px;
    padding: 0;
  }

  /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¯Ø§Ø®Ù„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© */
  .word-list .controls {
    display: flex;
    align-items: center;
    flex-shrink: 0;
  }
  
  .word-list button {
    padding: 4px 6px;
    margin: 0 3px;
    font-size: 14px;
    box-shadow: none;
  }
  
  /* Ø²Ø± Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù„ÙƒÙ„ ÙƒÙ„Ù…Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©) */
  .copy-btn-word {
    background: #6c757d; /* Ø±Ù…Ø§Ø¯ÙŠ Ù„Ø²Ø± Ø§Ù„Ù†Ø³Ø® */
    margin-left: 5px;
    margin-right: 5px;
  }
  .copy-btn-word:hover {
    background: #5a6268;
  }

  .word-list .speak-btn {
    position: static;
    transform: none;
    font-size: 16px;
    padding: 0;
    margin-left: 5px;
    margin-right: 5px;
  }

  /* Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© */
  @media (max-width: 900px) {
    #translation-area {
      flex-direction: column; /* ØªØªØ±Ø§ÙƒÙ… Ø±Ø£Ø³ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
    }
    .translator-box {
      height: 150px; /* Ø§Ø±ØªÙØ§Ø¹ Ø£Ù‚Ù„ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    }
    #main {
      padding: 20px;
      margin-right: 0; /* Ø¥Ù„ØºØ§Ø¡ Ù‡Ø§Ù…Ø´ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
      max-width: 100%;
    }
    #sidebar {
      width: 100%;
      height: 50vh;
      transform: translateY(100%);
      bottom: 0;
      top: auto;
      border-left: none;
      border-top: 1px solid var(--border-color-light);
    }
    #sidebar.hidden {
      transform: translateY(0%);
    }
    #toggleSidebar {
      right: 15px;
      top: 15px;
    }
    .session-item button {
        margin-right: 0;
    }
  }

</style>
</head>


<body>
<div id="sidebar" class="hidden">
  <h3>Ø§Ù„Ø¬Ù„Ø³Ø§Øª</h3>
  <div id="sessionList"></div>
  <button onclick="newSession()" title="New session">+ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
</div>

<div id="main">
  <button id="toggleSidebar" title="Side menu">â˜°</button>
  <button id="darkToggle" title="Change brightness">ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†</button>
  <h2>Ø§Ù„Ù…ØªØ±Ø¬Ù… - The Translator</h2>
  
  <!-- 3. Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ±Ø© -->
  <div id="translation-area">
    
    <!-- Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ -->
    <div id="input-box" class="translator-box">
        <textarea id="inputWord" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§..." oninput="handleInput()"></textarea>
        <button class="speak-btn" onclick="speakText(document.getElementById('inputWord').value)" title="Listen">ğŸ”Š</button>
    </div>
    
    <!-- Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬ (Ø§Ù„ØªØ±Ø¬Ù…Ø©) -->
    <div id="output-box" class="translator-box">
        <textarea id="outputWord" placeholder="Ø§Ù„ØªØ±Ø¬Ù…Ø©..." readonly></textarea>
        <button class="speak-btn" onclick="speakText(document.getElementById('outputWord').value)" title="Listen">ğŸ”Š</button>
    </div>
  </div>
  
  <div id="actionButtons">
    <button onclick="saveWord()" title="Save">ğŸ’¾</button>
    <button onclick="clearOutput()" title="Delete">âœ–</button>
  </div>
  
  <h3>Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© - Saved words ğŸ’¾</h3>
  <div id="savedWords" class="word-list"></div>
</div>

<script>
// ---------- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø±Ù…Ø¬Ø© ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù†Ø·Ù‚ (TTS) ----------
const synth = window.speechSynthesis;
let defaultArabicVoice = null;
let defaultEnglishVoice = null;

function setupVoices() {
    if (defaultArabicVoice && defaultEnglishVoice) return;
    const voices = synth.getVoices();
    defaultArabicVoice = voices.find(v => v.lang.startsWith('ar')) || voices.find(v => v.lang.includes('Arabic')) || null;
    defaultEnglishVoice = voices.find(v => v.lang.startsWith('en')) || voices.find(v => v.lang.includes('English')) || null;
}
// Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª
if (synth) {
  synth.onvoiceschanged = setupVoices;
  setupVoices(); // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙÙˆØ±ÙŠ
} else {
  console.warn("Speech Synthesis API not supported in this browser.");
}

function speakText(text) {
    if (!text || !synth) return;
    synth.cancel();

    let isArabic = /[\u0600-\u06FF]/.test(text);
    const utterance = new SpeechSynthesisUtterance(text);

    if (isArabic) {
        utterance.voice = defaultArabicVoice;
        utterance.lang = 'ar-SA';
    } else {
        utterance.voice = defaultEnglishVoice;
        utterance.lang = 'en-US';
    }
    
    synth.speak(utterance);
}
// -------------------------------------------------------------

// ---------- ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù…ÙØ­Ø³Ù‘Ù†Ø© (1. Ø¥ØµÙ„Ø§Ø­ Ø²Ø± Ø§Ù„Ù†Ø³Ø®) ----------
async function copyText(e, textToCopy) {
    e.stopPropagation();
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø±Ù…Ø¬Ø© ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø­Ø§ÙØ¸Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
    if (navigator.clipboard) {
        try {
            await navigator.clipboard.writeText(textToCopy);
            showCopyFeedback(e.currentTarget);
        } catch (err) {
            console.error('Failed to copy using modern API. Falling back to execCommand:', err);
            // Fallback (Ù‚Ø¯ Ù„Ø§ ÙŠØ¹Ù…Ù„ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ iFrames)
            if (document.execCommand) {
                 fallbackCopy(textToCopy, e.currentTarget);
            } else {
                 alert('Ø§Ù„Ù†Ø³Ø® ÙØ´Ù„. Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©.');
            }
        }
    } else if (document.execCommand) {
        fallbackCopy(textToCopy, e.currentTarget);
    } else {
        alert('Ø§Ù„Ù†Ø³Ø® ÙØ´Ù„. Ù„Ø§ ÙŠØªÙˆÙØ± Ø¯Ø¹Ù… Ù„Ù„Ø­Ø§ÙØ¸Ø©.');
    }
}

function fallbackCopy(text, button) {
    const textarea = document.createElement('textarea');
    textarea.value = text;
    textarea.style.position = 'fixed';
    textarea.style.left = '-9999px';
    document.body.appendChild(textarea);
    textarea.select();
    try {
        document.execCommand('copy');
        showCopyFeedback(button);
    } catch (err) {
        console.error('Fallback copy failed:', err);
    } finally {
        document.body.removeChild(textarea);
    }
}

function showCopyFeedback(button) {
    const originalText = button.textContent;
    button.textContent = 'âœ…';
    setTimeout(() => {
        button.textContent = originalText;
    }, 1500);
}
// -------------------------------------------------------------


// ---------- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª ----------
const DEFAULT_SESSION_NAME = "Ø¬Ù„Ø³Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠØ©";

(function applySavedTheme() {
  const savedTheme = localStorage.getItem('theme');
  if (savedTheme === 'dark') {
    document.body.classList.add('dark');
    document.getElementById('darkToggle').textContent = 'â˜€ï¸ Light Mode';
  } else {
    document.getElementById('darkToggle').textContent = 'ğŸŒ™ Dark Mode';
  }
})();

let debounceTimer;
let sessions = {};

try {
  sessions = JSON.parse(localStorage.getItem("sessions") || "{}");
} catch (e) {
  console.error("Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ù…Ù† localStorage:", e);
  sessions = {};
}

if (Object.keys(sessions).length === 0) {
    sessions[DEFAULT_SESSION_NAME] = [];
}

let current = localStorage.getItem("currentSession") || DEFAULT_SESSION_NAME;

if (!sessions[current]) {
    current = DEFAULT_SESSION_NAME;
}

let dragSrcIndex = null;
renderSessions();
renderWords();

function newSession() {
  let name = prompt("Ø§Ø³Ù… Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:");
  if (!name) return;
  
  if (sessions[name]) {
    alert("Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„!");
    return;
  }
  sessions[name] = [];
  current = name;
  saveSessions();
  renderSessions();
  renderWords();
  document.getElementById("sidebar").classList.add("hidden");
}

// 2. Ø£Ù…ÙƒØ§Ù†ÙŠØ© ØªØ¹Ø¯ÙŠÙ„ Ø£Ø³Ù… Ø§Ù„Ø¬Ù„Ø³Ø©
function editSessionName(oldName) {
    let newName = prompt(`ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ø¬Ù„Ø³Ø© "${oldName}":`, oldName);
    if (!newName || newName === oldName || !newName.trim()) return;

    if (sessions[newName]) {
        alert("Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„ Ø£Ùˆ Ù‡Ùˆ Ø§Ø³Ù… Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©.");
        return;
    }

    // Ù†Ù‚Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯
    sessions[newName] = sessions[oldName];
    delete sessions[oldName];
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    if (current === oldName) {
        current = newName;
    }
    
    saveSessions();
    renderSessions();
}

function renderSessions() {
  let box = document.getElementById("sessionList");
  box.innerHTML = "";
  
  if (!sessions[DEFAULT_SESSION_NAME]) {
     sessions[DEFAULT_SESSION_NAME] = [];
  }
  
  localStorage.setItem("currentSession", current);

  for (let s in sessions) {
    let div = document.createElement("div");
    div.className = "session-item";
    
    if (s === current) {
      div.classList.add("active");
    }
    
    let isDefault = (s === DEFAULT_SESSION_NAME);
    
    // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø¬Ù„Ø³Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    let editBtnHtml = !isDefault
      ? `<button class="edit-btn" onclick="editSessionName('${s}')" title="Name change">âœï¸</button>`
      : ''; 
      
    let deleteBtnHtml = !isDefault
      ? `<button onclick="deleteSession(event, '${s}')" title="Delete">âœ–</button>`
      : '';
      
    div.innerHTML = `
        <span>${s}</span>
        <div>
            ${editBtnHtml}
            ${deleteBtnHtml}
        </div>
    `;
    
    div.onclick = (e) => {
      // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø­Ø°Ù Ø£Ùˆ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
      if (e.target.tagName !== "BUTTON") {
        current = s;
        renderSessions();
        renderWords();
        document.getElementById("sidebar").classList.add("hidden");
      }
    };
    box.appendChild(div);
  }
}

function deleteSession(e, name) {
  e.stopPropagation();
  delete sessions[name];
  if (current === name) {
    current = DEFAULT_SESSION_NAME; 
  }
  saveSessions();
  renderSessions();
  renderWords();
}

function renderWords() {
  let box = document.getElementById("savedWords");
  box.innerHTML = "";
  if (!current || !sessions[current]) {
    box.innerHTML = `<p>Ø§Ø®ØªØ± Ø¬Ù„Ø³Ø© Ø£Ùˆ Ø§Ø¨Ø¯Ø£ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø­ÙØ¸ Ø§Ù„ÙƒÙ„Ù…Ø§Øª. (Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${current})</p>`;
    return;
  }
  
  sessions[current].forEach((w, i) => {
    // 1. Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù†Ø³Ø® Ù„Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© (w[0]) Ùˆ Ø²Ø± Ù†Ø³Ø® Ù„Ù„ØªØ±Ø¬Ù…Ø© (w[1])
    let d = document.createElement("div");
    d.draggable = true;
    d.dataset.index = i;
    
    // Ù„ØªØ¨Ø³ÙŠØ· Ø§Ù„ÙƒÙˆØ¯ØŒ Ù†Ø³ØªØ®Ø¯Ù… backticks ` ÙˆÙ„ØºØ© Escape Ù„Ù„Ø­Ù…Ø§ÙŠØ©
    d.innerHTML = `
      <div class="word-pair">
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© -->
        <button class="speak-btn" onclick="speakText('${w[0].replace(/'/g, "\\'")}')"  title="Listen">ğŸ”Š</button> 
        <button class="copy-btn-word" onclick="copyText(event, \`${w[0].replace(/`/g, '\\`').replace(/'/g, "\\'")}\`)" title="Copy">ğŸ“‹</button>
        <span onclick="loadWord('${w[0].replace(/'/g, "\\'")}', '${w[1].replace(/'/g, "\\'")}')">${w[0]}</span>
      </div>
       
      <div class="word-pair">
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ±Ø¬Ù…Ø© -->
        <button class="speak-btn" onclick="speakText('${w[1].replace(/'/g, "\\'")}')"  title="Listen">ğŸ”Š</button>
        <button class="copy-btn-word" onclick="copyText(event, \`${w[1].replace(/`/g, '\\`').replace(/'/g, "\\'")}\`)" title="Copy" >ğŸ“‹</button>
        <span onclick="loadWord('${w[0].replace(/'/g, "\\'")}', '${w[1].replace(/'/g, "\\'")}')">${w[1]}</span>
      </div>
      <div class="controls">
        <button onclick="del(event, ${i})" title="Delete">âœ–</button>
      </div>
    `;
    
    d.addEventListener("dragstart", dragStart);
    d.addEventListener("dragover", dragOver);
    d.addEventListener("drop", drop);
    d.addEventListener("dragend", dragEnd);
    box.appendChild(d);
  });
}

function loadWord(source, target) {
    document.getElementById("inputWord").value = source;
    document.getElementById("outputWord").value = target;
}

function dragStart(e) {
  dragSrcIndex = e.currentTarget.dataset.index;
  e.dataTransfer.effectAllowed = "move";
  e.currentTarget.style.opacity = '0.4';
}
function dragOver(e) {
  e.preventDefault();
  e.dataTransfer.dropEffect = "move";
}
function drop(e) {
  e.preventDefault();
  let targetEl = e.currentTarget;
  let targetIndex = targetEl.dataset.index;
  
  if (dragSrcIndex === null || targetIndex === dragSrcIndex) return;

  let itemToMove = sessions[current].splice(dragSrcIndex, 1)[0];
  sessions[current].splice(targetIndex, 0, itemToMove);
  
  dragSrcIndex = null;
  saveSessions();
  renderWords();
}
function dragEnd(e) {
  e.currentTarget.style.opacity = '1';
  dragSrcIndex = null;
}

function saveWord() {
  let w = document.getElementById("inputWord").value.trim();
  if (!w) return;
  
  if (!current) current = DEFAULT_SESSION_NAME;

  let t = document.getElementById("outputWord").value.trim();
  if (!t || t === "ÙŠØªÙ… Ø§Ù„ØªØ±Ø¬Ù…Ø©...") {
    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù†ØªØ¸Ø§Ø± Ø¸Ù‡ÙˆØ± Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø£ÙˆÙ„Ø§Ù‹.");
    return;
  }
  
  sessions[current].push([w, t]);
  saveSessions();
  renderWords();
  document.getElementById("inputWord").value = "";
  document.getElementById("outputWord").value = "";
}

function clearOutput() {
  document.getElementById("inputWord").value = "";
  document.getElementById("outputWord").value = "";
}

function del(e, i) {
  e.stopPropagation();
  sessions[current].splice(i, 1);
  saveSessions();
  renderWords();
}

function saveSessions() {
  localStorage.setItem("sessions", JSON.stringify(sessions));
}

async function translate(text) {
  if (!text) return "";
  try {
    let isArabic = /[\u0600-\u06FF]/.test(text);
    let targetLang = isArabic ? "en" : "ar";
    let sourceLang = isArabic ? "ar" : (/[a-zA-Z]/.test(text) ? "en" : "auto");
    
    let r = await fetch(
      `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${sourceLang}&tl=${targetLang}&dt=t&q=${encodeURIComponent(text)}`
    );
    let data = await r.json();
    return data[0].map(segment => segment[0]).join('');
  } catch (e) {
    console.error("Translation error:", e);
    return "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„";
  }
}

// Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (Ù…Ø¹ Debouncing)
function handleInput() {
    clearTimeout(debounceTimer);
    let text = inputWord.value.trim();
    if (!text) {
        outputWord.value = "";
        return;
    }
    
    outputWord.value = "ÙŠØªÙ… Ø§Ù„ØªØ±Ø¬Ù…Ø©...";
    
    debounceTimer = setTimeout(async () => {
        outputWord.value = await translate(text);
    }, 500);
}

// -- Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø« --

document.getElementById("toggleSidebar").onclick = () => {
  document.getElementById("sidebar").classList.toggle("hidden");
};

document.getElementById("darkToggle").onclick = () => {
  document.body.classList.toggle("dark");
  if (document.body.classList.contains("dark")) {
    localStorage.setItem('theme', 'dark');
    document.getElementById('darkToggle').textContent = 'â˜€ï¸ Light Mode';
  } else {
    localStorage.setItem('theme', 'light');
    document.getElementById('darkToggle').textContent = 'ğŸŒ™ Dark Mode';
  }
};
</script>
</body>
</html>
